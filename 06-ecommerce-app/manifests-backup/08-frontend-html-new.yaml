apiVersion: v1
kind: ConfigMap
metadata:
  name: ecommerce-ui-html
  namespace: ecommerce
data:
  index.html: |
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>TechShop - E-commerce Kubernetes Demo</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #f8f9fa;
                color: #333;
                line-height: 1.6;
            }
            
            .header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 1rem 0;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            
            .nav {
                display: flex;
                justify-content: space-between;
                align-items: center;
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 2rem;
            }
            
            .logo {
                font-size: 1.8rem;
                font-weight: bold;
            }
            
            .nav-links {
                display: flex;
                gap: 2rem;
                list-style: none;
            }
            
            .nav-links a {
                color: white;
                text-decoration: none;
                transition: opacity 0.3s;
            }
            
            .nav-links a:hover {
                opacity: 0.8;
            }
            
            .cart-icon {
                position: relative;
                cursor: pointer;
                font-size: 1.2rem;
            }
            
            .cart-count {
                position: absolute;
                top: -8px;
                right: -8px;
                background: #ff4757;
                color: white;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.8rem;
                font-weight: bold;
            }
            
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 2rem;
            }
            
            .hero {
                background: linear-gradient(rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
                border-radius: 15px;
                padding: 3rem;
                text-align: center;
                margin-bottom: 3rem;
            }
            
            .hero h1 {
                font-size: 3rem;
                margin-bottom: 1rem;
                color: #2c3e50;
            }
            
            .hero p {
                font-size: 1.2rem;
                color: #7f8c8d;
                margin-bottom: 2rem;
            }
            
            .infrastructure-badge {
                display: inline-block;
                background: #3498db;
                color: white;
                padding: 0.5rem 1rem;
                border-radius: 25px;
                font-size: 0.9rem;
            }
            
            .section-title {
                font-size: 2rem;
                margin-bottom: 1.5rem;
                text-align: center;
                color: #2c3e50;
            }
            
            .products-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 2rem;
                margin-bottom: 3rem;
            }
            
            .product-card {
                background: white;
                border-radius: 15px;
                padding: 1.5rem;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            
            .product-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            }
            
            .product-image {
                width: 100%;
                height: 200px;
                background: linear-gradient(45deg, #f1f2f6, #ddd);
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 3rem;
                margin-bottom: 1rem;
            }
            
            .product-title {
                font-size: 1.3rem;
                font-weight: bold;
                margin-bottom: 0.5rem;
                color: #2c3e50;
            }
            
            .product-description {
                color: #7f8c8d;
                margin-bottom: 1rem;
                font-size: 0.9rem;
            }
            
            .product-price {
                font-size: 1.5rem;
                font-weight: bold;
                color: #27ae60;
                margin-bottom: 1rem;
            }
            
            .product-stock {
                font-size: 0.9rem;
                color: #f39c12;
                margin-bottom: 1rem;
            }
            
            .btn {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 0.8rem 1.5rem;
                border-radius: 25px;
                cursor: pointer;
                font-size: 1rem;
                transition: transform 0.3s ease;
                width: 100%;
            }
            
            .btn:hover {
                transform: scale(1.05);
            }
            
            .btn:disabled {
                background: #bdc3c7;
                cursor: not-allowed;
                transform: none;
            }
            
            .cart-sidebar {
                position: fixed;
                top: 0;
                right: -400px;
                width: 400px;
                height: 100vh;
                background: white;
                box-shadow: -5px 0 15px rgba(0,0,0,0.1);
                transition: right 0.3s ease;
                z-index: 1000;
                overflow-y: auto;
            }
            
            .cart-sidebar.open {
                right: 0;
            }
            
            .cart-header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 1rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .cart-close {
                background: none;
                border: none;
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
            }
            
            .cart-content {
                padding: 1rem;
            }
            
            .cart-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem 0;
                border-bottom: 1px solid #ecf0f1;
            }
            
            .cart-item-info {
                flex: 1;
            }
            
            .cart-item-title {
                font-weight: bold;
                margin-bottom: 0.25rem;
            }
            
            .cart-item-price {
                color: #27ae60;
                font-weight: bold;
            }
            
            .cart-item-quantity {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin: 0.5rem 0;
            }
            
            .quantity-btn {
                background: #3498db;
                color: white;
                border: none;
                width: 25px;
                height: 25px;
                border-radius: 50%;
                cursor: pointer;
                font-size: 0.8rem;
            }
            
            .cart-total {
                text-align: center;
                padding: 1rem;
                border-top: 2px solid #3498db;
                margin-top: 1rem;
            }
            
            .cart-total-amount {
                font-size: 1.5rem;
                font-weight: bold;
                color: #27ae60;
                margin-bottom: 1rem;
            }
            
            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0,0,0,0.5);
                z-index: 999;
                display: none;
            }
            
            .overlay.show {
                display: block;
            }
            
            .microservices-status {
                background: white;
                border-radius: 15px;
                padding: 2rem;
                margin-top: 3rem;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }
            
            .microservices-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1rem;
                margin-top: 1rem;
            }
            
            .microservice-item {
                background: #f8f9fa;
                padding: 1rem;
                border-radius: 10px;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            
            .status-dot {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: #2ecc71;
                animation: pulse 2s infinite;
            }
            
            @keyframes pulse {
                0% { opacity: 1; }
                50% { opacity: 0.5; }
                100% { opacity: 1; }
            }
            
            .footer {
                background: #2c3e50;
                color: white;
                text-align: center;
                padding: 2rem;
                margin-top: 3rem;
            }
            
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                background: #2ecc71;
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                z-index: 1001;
                transform: translateX(400px);
                transition: transform 0.3s ease;
            }
            
            .notification.show {
                transform: translateX(0);
            }
        </style>
    </head>
    <body>
        <div class="overlay" id="overlay"></div>
        
        <header class="header">
            <nav class="nav">
                <div class="logo">üõí TechShop</div>
                <ul class="nav-links">
                    <li><a href="#products">Products</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#microservices">Architecture</a></li>
                </ul>
                <div class="cart-icon" onclick="toggleCart()">
                    üõçÔ∏è <span class="cart-count" id="cartCount">0</span>
                </div>
            </nav>
        </header>
        
        <div class="container">
            <section class="hero">
                <h1>Welcome to TechShop</h1>
                <p>A complete E-commerce application running on Kubernetes microservices</p>
                <div class="infrastructure-badge">
                    üöÄ EKS + Karpenter + WAF + Prometheus + Grafana
                </div>
            </section>
            
            <section id="products">
                <h2 class="section-title">Our Products</h2>
                <div class="products-grid" id="productsGrid">
                    <!-- Products will be loaded here -->
                </div>
            </section>
            
            <section id="microservices" class="microservices-status">
                <h2 class="section-title">Microservices Architecture</h2>
                <p style="text-align: center; color: #7f8c8d; margin-bottom: 1rem;">
                    Real-time status of all microservices powering this e-commerce platform
                </p>
                <div class="microservices-grid" id="microservicesGrid">
                    <!-- Microservices status will be loaded here -->
                </div>
            </section>
        </div>
        
        <div class="cart-sidebar" id="cartSidebar">
            <div class="cart-header">
                <h3>Shopping Cart</h3>
                <button class="cart-close" onclick="toggleCart()">√ó</button>
            </div>
            <div class="cart-content" id="cartContent">
                <p style="text-align: center; color: #7f8c8d; padding: 2rem;">
                    Your cart is empty
                </p>
            </div>
            <div class="cart-total" id="cartTotal" style="display: none;">
                <div class="cart-total-amount" id="totalAmount">$0.00</div>
                <button class="btn" onclick="checkout()">Proceed to Checkout</button>
            </div>
        </div>
        
        <div class="notification" id="notification">
            Product added to cart!
        </div>
        
        <footer class="footer">
            <p>üöÄ <strong>TechShop E-commerce</strong> - Powered by Kubernetes Microservices</p>
            <p>EKS + Terraform + Karpenter + AWS WAF + Prometheus + Grafana</p>
            <p><strong>Cluster:</strong> eks-devopsproject-cluster | <strong>Region:</strong> us-east-1</p>
        </footer>
        
        <script>
            // Global state
            let products = [];
            let cart = [];
            let microservices = [
                { name: 'Product Catalog', endpoint: '/api/products', status: 'checking' },
                { name: 'Order Management', endpoint: '/api/orders', status: 'checking' },
                { name: 'Inventory Service', endpoint: '/api/inventory', status: 'checking' },
                { name: 'Profile Management', endpoint: '/api/profile', status: 'checking' },
                { name: 'Shipping Service', endpoint: '/api/shipping', status: 'checking' },
                { name: 'Support Service', endpoint: '/api/support', status: 'checking' },
                { name: 'Frontend API', endpoint: '/api/health', status: 'checking' }
            ];
            
            // Sample products data
            const sampleProducts = [
                {
                    id: 1,
                    name: 'Gaming Laptop',
                    description: 'High-performance laptop for gaming and development',
                    price: 1299.99,
                    stock: 15,
                    emoji: 'üíª'
                },
                {
                    id: 2,
                    name: 'Wireless Headphones',
                    description: 'Premium noise-canceling wireless headphones',
                    price: 299.99,
                    stock: 32,
                    emoji: 'üéß'
                },
                {
                    id: 3,
                    name: 'Smartphone',
                    description: 'Latest flagship smartphone with advanced features',
                    price: 899.99,
                    stock: 24,
                    emoji: 'üì±'
                },
                {
                    id: 4,
                    name: 'Smart Watch',
                    description: 'Fitness tracking and smart notifications',
                    price: 399.99,
                    stock: 18,
                    emoji: '‚åö'
                },
                {
                    id: 5,
                    name: 'Tablet',
                    description: 'Lightweight tablet for work and entertainment',
                    price: 599.99,
                    stock: 27,
                    emoji: 'üìÑ'
                },
                {
                    id: 6,
                    name: 'Bluetooth Speaker',
                    description: 'Portable speaker with excellent sound quality',
                    price: 129.99,
                    stock: 45,
                    emoji: 'üîä'
                }
            ];
            
            // Initialize the application
            window.addEventListener('DOMContentLoaded', function() {
                loadProducts();
                loadMicroservicesStatus();
                setInterval(loadMicroservicesStatus, 30000); // Update every 30 seconds
            });
            
            function loadProducts() {
                products = sampleProducts;
                renderProducts();
            }
            
            function renderProducts() {
                const grid = document.getElementById('productsGrid');
                grid.innerHTML = products.map(product => `
                    <div class="product-card">
                        <div class="product-image">${product.emoji}</div>
                        <div class="product-title">${product.name}</div>
                        <div class="product-description">${product.description}</div>
                        <div class="product-price">$${product.price.toFixed(2)}</div>
                        <div class="product-stock">${product.stock} in stock</div>
                        <button class="btn" onclick="addToCart(${product.id})" ${product.stock === 0 ? 'disabled' : ''}>
                            ${product.stock === 0 ? 'Out of Stock' : 'Add to Cart'}
                        </button>
                    </div>
                `).join('');
            }
            
            function addToCart(productId) {
                const product = products.find(p => p.id === productId);
                if (!product || product.stock === 0) return;
                
                const cartItem = cart.find(item => item.id === productId);
                if (cartItem) {
                    cartItem.quantity += 1;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                
                // Update stock
                product.stock -= 1;
                
                updateCartDisplay();
                renderProducts();
                showNotification('Product added to cart!');
            }
            
            function removeFromCart(productId) {
                const cartItemIndex = cart.findIndex(item => item.id === productId);
                if (cartItemIndex > -1) {
                    const cartItem = cart[cartItemIndex];
                    const product = products.find(p => p.id === productId);
                    
                    // Return stock
                    product.stock += cartItem.quantity;
                    
                    cart.splice(cartItemIndex, 1);
                    updateCartDisplay();
                    renderProducts();
                }
            }
            
            function updateQuantity(productId, change) {
                const cartItem = cart.find(item => item.id === productId);
                const product = products.find(p => p.id === productId);
                
                if (!cartItem || !product) return;
                
                const newQuantity = cartItem.quantity + change;
                
                if (newQuantity <= 0) {
                    removeFromCart(productId);
                    return;
                }
                
                if (change > 0 && product.stock <= 0) {
                    return; // Can't add more, no stock
                }
                
                cartItem.quantity = newQuantity;
                product.stock -= change;
                
                updateCartDisplay();
                renderProducts();
            }
            
            function updateCartDisplay() {
                const cartCount = document.getElementById('cartCount');
                const cartContent = document.getElementById('cartContent');
                const cartTotal = document.getElementById('cartTotal');
                const totalAmount = document.getElementById('totalAmount');
                
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = totalItems;
                
                if (cart.length === 0) {
                    cartContent.innerHTML = `
                        <p style="text-align: center; color: #7f8c8d; padding: 2rem;">
                            Your cart is empty
                        </p>
                    `;
                    cartTotal.style.display = 'none';
                } else {
                    cartContent.innerHTML = cart.map(item => `
                        <div class="cart-item">
                            <div class="cart-item-info">
                                <div class="cart-item-title">${item.name}</div>
                                <div class="cart-item-price">$${item.price.toFixed(2)}</div>
                                <div class="cart-item-quantity">
                                    <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                                    <span>Qty: ${item.quantity}</span>
                                    <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                                </div>
                            </div>
                            <button class="btn" style="width: auto; padding: 0.5rem;" onclick="removeFromCart(${item.id})">
                                Remove
                            </button>
                        </div>
                    `).join('');
                    
                    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    totalAmount.textContent = `$${total.toFixed(2)}`;
                    cartTotal.style.display = 'block';
                }
            }
            
            function toggleCart() {
                const sidebar = document.getElementById('cartSidebar');
                const overlay = document.getElementById('overlay');
                
                sidebar.classList.toggle('open');
                overlay.classList.toggle('show');
            }
            
            function checkout() {
                if (cart.length === 0) return;
                
                // Simulate order processing
                const orderData = {
                    items: cart,
                    total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                    timestamp: new Date().toISOString()
                };
                
                // Send order to order management service
                fetch('/api/orders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                }).then(() => {
                    alert(`Order placed successfully! Total: $${orderData.total.toFixed(2)}`);
                    cart = [];
                    updateCartDisplay();
                    toggleCart();
                }).catch(() => {
                    alert('Order placed successfully! (Simulated)');
                    cart = [];
                    updateCartDisplay();
                    toggleCart();
                });
            }
            
            function showNotification(message) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            async function loadMicroservicesStatus() {
                const grid = document.getElementById('microservicesGrid');
                
                for (let i = 0; i < microservices.length; i++) {
                    const service = microservices[i];
                    
                    try {
                        const response = await fetch(service.endpoint);
                        service.status = response.ok ? 'healthy' : 'error';
                    } catch (error) {
                        service.status = 'error';
                    }
                }
                
                grid.innerHTML = microservices.map(service => `
                    <div class="microservice-item">
                        <div class="status-dot" style="background-color: ${service.status === 'healthy' ? '#2ecc71' : '#e74c3c'}"></div>
                        <span>${service.name}</span>
                    </div>
                `).join('');
            }
            
            // Close cart when clicking overlay
            document.getElementById('overlay').addEventListener('click', toggleCart);
        </script>
    </body>
    </html>